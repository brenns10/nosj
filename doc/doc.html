

<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" />
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  
  <title>NOSJ Documentation &mdash; NOSJ 0.1 documentation</title>
  

  
  <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="_static/pygments.css" type="text/css" />

  
  

  
  

  

  
  <!--[if lt IE 9]>
    <script src="_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="./" src="_static/documentation_options.js"></script>
        <script src="_static/jquery.js"></script>
        <script src="_static/underscore.js"></script>
        <script src="_static/doctools.js"></script>
    
    <script type="text/javascript" src="_static/js/theme.js"></script>

    
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="NOSJ API Reference" href="api.html" />
    <link rel="prev" title="Welcome to NOSJ’s documentation!" href="index.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="index.html" class="icon icon-home"> NOSJ
          

          
          </a>

          
            
            
              <div class="version">
                0.1
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        
        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <ul class="current">
<li class="toctree-l1 current"><a class="current reference internal" href="#">NOSJ Documentation</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#introduction-to-json">Introduction to JSON</a></li>
<li class="toctree-l2"><a class="reference internal" href="#motivation">Motivation</a></li>
<li class="toctree-l2"><a class="reference internal" href="#nosj-basics">NOSJ Basics</a></li>
<li class="toctree-l2"><a class="reference internal" href="#unicode-support">Unicode Support</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="api.html">NOSJ API Reference</a></li>
</ul>

            
          
        </div>
        
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">NOSJ</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          

















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="index.html" class="icon icon-home"></a> &raquo;</li>
        
      <li>NOSJ Documentation</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
          
            <a href="_sources/doc.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="nosj-documentation">
<h1>NOSJ Documentation<a class="headerlink" href="#nosj-documentation" title="Permalink to this headline">¶</a></h1>
<div class="section" id="introduction-to-json">
<h2>Introduction to JSON<a class="headerlink" href="#introduction-to-json" title="Permalink to this headline">¶</a></h2>
<p>NOSJ is a C library for parsing data encoded in the JSON (JavaScript Object
Notation) format.  In case you’re not familiar, JSON is a simple format for
saving and transferring structured data.  One common use of JSON is in the
responses of many REST APIs (such as the Twitter API), although there are many
other applications.  Here is an example of some JSON data:</p>
<div class="highlight-json notranslate"><div class="highlight"><pre><span></span><span class="p">{</span>
  <span class="nt">&quot;coordinates&quot;</span><span class="p">:</span> <span class="kc">null</span><span class="p">,</span>
  <span class="nt">&quot;favorited&quot;</span><span class="p">:</span> <span class="kc">false</span><span class="p">,</span>
  <span class="nt">&quot;entities&quot;</span><span class="p">:</span> <span class="p">{</span>
    <span class="nt">&quot;urls&quot;</span><span class="p">:</span> <span class="p">[</span>
      <span class="p">{</span>
        <span class="nt">&quot;expanded_url&quot;</span><span class="p">:</span> <span class="s2">&quot;https://dev.twitter.com/terms/display-guidelines&quot;</span><span class="p">,</span>
        <span class="nt">&quot;url&quot;</span><span class="p">:</span> <span class="s2">&quot;https://t.co/Ed4omjYs&quot;</span><span class="p">,</span>
        <span class="nt">&quot;indices&quot;</span><span class="p">:</span> <span class="p">[</span>
          <span class="mi">76</span><span class="p">,</span>
          <span class="mi">97</span>
        <span class="p">],</span>
        <span class="nt">&quot;display_url&quot;</span><span class="p">:</span> <span class="s2">&quot;dev.twitter.com/terms/display-\u2026&quot;</span>
      <span class="p">}</span>
    <span class="p">],</span>
    <span class="nt">&quot;hashtags&quot;</span><span class="p">:</span> <span class="p">[</span>
      <span class="p">{</span>
        <span class="nt">&quot;text&quot;</span><span class="p">:</span> <span class="s2">&quot;Twitterbird&quot;</span><span class="p">,</span>
        <span class="nt">&quot;indices&quot;</span><span class="p">:</span> <span class="p">[</span>
          <span class="mi">19</span><span class="p">,</span>
          <span class="mi">31</span>
        <span class="p">]</span>
      <span class="p">}</span>
    <span class="p">],</span>
    <span class="nt">&quot;user_mentions&quot;</span><span class="p">:</span> <span class="p">[</span>

    <span class="p">]</span>
  <span class="p">},</span>
<span class="p">}</span>
</pre></div>
</div>
<p>This is a truncated selection from a larger example Twitter API response.  From
it, you can see that JSON has the following data types:</p>
<ul class="simple">
<li><p>Null (really a placeholder value that means “nothing”).</p></li>
<li><p>Booleans, AKA true or false.</p></li>
<li><p>Numbers, which can be integer or have additional precision.</p></li>
<li><p>Strings, which should be capable of representing any sequence of Unicode code
points.</p></li>
<li><p>Arrays, which are lists of values surrounded by <code class="docutils literal notranslate"><span class="pre">[]</span></code> brackets.</p></li>
<li><p>Objects, which map string keys to values of any type.  These are surrounded by
<code class="docutils literal notranslate"><span class="pre">{}</span></code> braces.</p></li>
</ul>
<p>A full description of JSON’s syntax is beyond the scope of this document, but
you can find JSON standards at <a class="reference external" href="http://json.org">http://json.org</a> .</p>
</div>
<div class="section" id="motivation">
<h2>Motivation<a class="headerlink" href="#motivation" title="Permalink to this headline">¶</a></h2>
<p>JSON offers very few surprises, especially to those familiar with the data
structures typically provided by high level languages.  These languages
typically have no trouble integrating JSON parsing very simply into their
built-in data structures.  Unfortunately, C doesn’t have built-in data
structures to match all of these features.  What’s worse, C requires manual
memory management, which means that every single bit of memory allocated for
these data structures needs to be freed when it’s no longer used.  This can be
very costly in all of the following ways:</p>
<ul class="simple">
<li><p>Memory usage: complex JSON requires allocating space, and potentially a lot of
it, for data structures.</p></li>
<li><p>Memory allocations: memory allocation is not a simple or efficient task.
Frequent allocations (one for each JSON value or data structure) can be very
inefficient.</p></li>
<li><p>Programmer time: memory allocations by a library need to be freed at the
correct time.  It can be difficult for a programmer to grasp the memory
management strategies of other libraries, and even worse to try to integrate
those strategies into their own application’s strategy.</p></li>
<li><p>Locality: when many data structures are allocated separately, they end up
sprinkled throughout the memory space of the application.  Chasing pointers
through these data structures can result in more frequent page faults.</p></li>
</ul>
<p>While there are certainly situations where these inefficiencies are acceptable
or necessary, they probably do not make up the majority of use cases for JSON.
Many times, a programmer only wants a few values out of an API response, not the
whole data structure.  NOSJ is a library that aims to satisfy that use case.  It
doesn’t do any memory allocation on its own, leaving those decisions up to the
user.  It only loads values into memory when asked to.</p>
</div>
<div class="section" id="nosj-basics">
<h2>NOSJ Basics<a class="headerlink" href="#nosj-basics" title="Permalink to this headline">¶</a></h2>
<p>Getting information from JSON with NOSJ is a two step process.  The first step
is parsing.  You do this with the function <a class="reference internal" href="api.html#c.json_parse" title="json_parse"><code class="xref c c-func docutils literal notranslate"><span class="pre">json_parse()</span></code></a>.  NOSJ needs
to read through the JSON buffer and determine the structure: namely, what types
of objects are where.  It stores this information in an array of <a class="reference internal" href="api.html#c.json_token" title="json_token"><code class="xref c c-func docutils literal notranslate"><span class="pre">struct</span>
<span class="pre">json_token</span></code></a>.  These “tokens” are not tokens in the sense of lexical
analysis.  Instead, every token represents a JSON value.  So, the following
input would have 3 tokens:</p>
<div class="highlight-json notranslate"><div class="highlight"><pre><span></span><span class="p">{</span><span class="nt">&quot;a&quot;</span><span class="p">:</span> <span class="mi">3</span><span class="p">}</span>
</pre></div>
</div>
<p>The first token would be the object.  The second token is the key “a”, and the
third token is the number 3.  As you can see, tokens (i.e. JSON values) can be
nested within one another in a tree structure.  NOSJ stores these tokens in an
array using a <a class="reference external" href="https://en.wikipedia.org/wiki/Tree_traversal#Pre-order">pre-order traversal</a>.  These tokens don’t
actually hold any of the JSON values.  They simply represent the structure of
the JSON document, and they hold the indices of each object in the input string.
For all the other NOSJ functions, you need to have both the input string and the
token array (along with the index of a token in the array) to do things.</p>
<p>When NOSJ parses your input, it only parses one complete JSON value.  This value
will always be at the root (index 0) of the token array.  Typically, this JSON
value is going to be something like an object or a list.  From there, you’ll
probably want to get items of a particular index (if it’s a list) or with a
certain key (if it’s an object).  You can do the following operations on your
parsed JSON:</p>
<ul class="simple">
<li><p>Index into a JSON list with <a class="reference internal" href="api.html#c.json_array_get" title="json_array_get"><code class="xref c c-func docutils literal notranslate"><span class="pre">json_array_get()</span></code></a>.  This will return to
you the index of the correct token in the token array.  Note that this has to
go item by item through the list, so it takes <code class="docutils literal notranslate"><span class="pre">O(n)</span></code> time.</p></li>
<li><p>Get the value associated with a key from an object with
<a class="reference internal" href="api.html#c.json_object_get" title="json_object_get"><code class="xref c c-func docutils literal notranslate"><span class="pre">json_object_get()</span></code></a>.  Again, this will return the index of the value in
the token array.  Also, this does a linear search through the keys of the
object.  While this would be inefficient in general (if you were constantly
looking up keys in the object), it is cheaper for a few accesses than it is to
build a hash table or binary tree.  I may add the ability to create a hash table
in order to improve lookup times, if this functionality becomes necessary.</p></li>
<li><p>If you have the index of a string, you can use <a class="reference internal" href="api.html#c.json_string_load" title="json_string_load"><code class="xref c c-func docutils literal notranslate"><span class="pre">json_string_load()</span></code></a> to
load it (processing all escape sequences properly) into memory.</p></li>
<li><p>If you have the index of a number, you can use <a class="reference internal" href="api.html#c.json_number_get" title="json_number_get"><code class="xref c c-func docutils literal notranslate"><span class="pre">json_number_get()</span></code></a> to
return its value (as a double).</p></li>
</ul>
<p>True, false, and null are all represented as separate <a class="reference internal" href="api.html#c.json_type" title="json_type"><code class="xref c c-func docutils literal notranslate"><span class="pre">types</span></code></a> in NOSJ.  These types are stored as metadata in the token array, so
you don’t even need a function to load those values into memory.</p>
<p>With these few functions, you can get any information out of a JSON data
structure, all with minimal memory allocation.</p>
</div>
<div class="section" id="unicode-support">
<h2>Unicode Support<a class="headerlink" href="#unicode-support" title="Permalink to this headline">¶</a></h2>
<p>When handling text, you always should be thinking about how to handle characters
beyond the ASCII range. The JSON specification indicates that the JSON file
format is a “sequence of Unicode code points”.  It doesn’t specify a particular
encoding.</p>
<p>In the world of Linux, (and broadly on the Internet) the most common character
encoding is UTF-8. NOSJ follows suit, and expects that your input is either
ASCII or UTF-8, and may optionally contain Unicode escape sequences within it.
NOSJ further assumes that you will only want to handle UTF-8 encoded data in
memory. Therefore, as it reads strings, NOSJ transparently handles Unicode
escape sequences such that they are converted into their corresponding UTF-8.</p>
<p>This is a major breaking change from the previous behavior of NOSJ. The library
no longer deals in terms of <code class="docutils literal notranslate"><span class="pre">wchar_t</span></code>.</p>
</div>
</div>


           </div>
           
          </div>
          <footer>
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
        <a href="api.html" class="btn btn-neutral float-right" title="NOSJ API Reference" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
        <a href="index.html" class="btn btn-neutral float-left" title="Welcome to NOSJ’s documentation!" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>
        &#169; Copyright 2015, Stephen Brennan.

    </p>
  </div>
    
    
    
    Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    
    provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>
        </div>
      </div>

    </section>

  </div>
  

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>